# K8s Resource Visualizer Backend - æµ‹è¯•æ€»ç»“

## æ¦‚è¿°
ä¸ºK8s Resource Visualizeråç«¯åº”ç”¨æ·»åŠ äº†å®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œå¹¶è¿›è¡Œäº†æ€§èƒ½ä¼˜åŒ–ã€‚

## å®Œæˆçš„å·¥ä½œ

### 1. å•å…ƒæµ‹è¯•è¦†ç›– âœ…
- **main_test.go**: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ŒåŒ…æ‹¬HTTPå¤„ç†å™¨å’Œå·¥å…·å‡½æ•°
- **handlers_test.go**: ä¸“é—¨çš„HTTPå¤„ç†å™¨æµ‹è¯•
- **utils_test.go**: å·¥å…·å‡½æ•°çš„è¯¦ç»†æµ‹è¯•
- **integration_test.go**: å®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶
- **performance_test.go**: æ€§èƒ½æµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•

### 2. æµ‹è¯•åŠŸèƒ½è¦†ç›–
#### HTTPç«¯ç‚¹æµ‹è¯•
- âœ… `GET /api/health` - å¥åº·æ£€æŸ¥
- âœ… `GET /api/namespaces` - è·å–å‘½åç©ºé—´åˆ—è¡¨
- âœ… `GET /api/resources/:type` - è·å–æŒ‡å®šç±»å‹çš„èµ„æº
- âœ… `GET /api/resources/:type/:name/children` - è·å–èµ„æºçš„å­èµ„æº

#### å·¥å…·å‡½æ•°æµ‹è¯•
- âœ… `getGVRForResourceType()` - èµ„æºç±»å‹æ˜ å°„
- âœ… `convertToResourceNode()` - èµ„æºè½¬æ¢
- âœ… `convertToResourceNodes()` - æ‰¹é‡èµ„æºè½¬æ¢
- âœ… `contains()` - åˆ‡ç‰‡åŒ…å«æ£€æŸ¥
- âœ… `findChildResources()` - å­èµ„æºæŸ¥æ‰¾ï¼ˆä¼˜åŒ–åï¼‰

#### é”™è¯¯åœºæ™¯æµ‹è¯•
- âœ… æœªçŸ¥èµ„æºç±»å‹
- âœ… èµ„æºä¸å­˜åœ¨
- âœ… ç½‘ç»œé”™è¯¯æ¨¡æ‹Ÿ
- âœ… å¹¶å‘è¯·æ±‚å¤„ç†

### 3. æ€§èƒ½ä¼˜åŒ– ğŸš€
#### ä¼˜åŒ–å‰çš„é—®é¢˜
- è·¨æ‰€æœ‰å‘½åç©ºé—´æœç´¢å­èµ„æº
- ä½¿ç”¨APIå‘ç°æœºåˆ¶éå†æ‰€æœ‰èµ„æºç±»å‹
- æ€§èƒ½è¾ƒå·®ï¼Œå»¶è¿Ÿè¾ƒé«˜

#### ä¼˜åŒ–åçš„æ”¹è¿›
- **é™åˆ¶æœç´¢èŒƒå›´**: åªåœ¨çˆ¶èµ„æºæ‰€åœ¨çš„åŒä¸€å‘½åç©ºé—´ä¸­æœç´¢
- **é¢„å®šä¹‰èµ„æºç±»å‹**: ä½¿ç”¨å¸¸è§èµ„æºç±»å‹åˆ—è¡¨ï¼Œé¿å…APIå‘ç°å¼€é”€
- **æ·»åŠ è¯¦ç»†æ—¥å¿—**: ä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **å¿…éœ€å‚æ•°éªŒè¯**: è¦æ±‚æä¾›namespaceå‚æ•°

#### æ€§èƒ½æå‡
```go
// ä¼˜åŒ–å‰: æœç´¢æ‰€æœ‰å‘½åç©ºé—´çš„æ‰€æœ‰èµ„æºç±»å‹
// ä¼˜åŒ–å: åªæœç´¢åŒä¸€å‘½åç©ºé—´çš„å¸¸è§èµ„æºç±»å‹
commonChildTypes := []schema.GroupVersionResource{
    {Group: "", Version: "v1", Resource: "pods"},
    {Group: "", Version: "v1", Resource: "services"},
    {Group: "", Version: "v1", Resource: "configmaps"},
    // ... ç­‰ç­‰
}
```

### 4. æ—¥å¿—å¢å¼º ğŸ“
æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼š
- å¯åŠ¨è¿‡ç¨‹æ—¥å¿—
- Kuberneteså®¢æˆ·ç«¯åˆå§‹åŒ–æ—¥å¿—
- APIè¯·æ±‚å¤„ç†æ—¥å¿—
- é”™è¯¯è¯¦æƒ…æ—¥å¿—
- æ€§èƒ½ç›‘æ§æ—¥å¿—

### 5. æµ‹è¯•å·¥å…· ğŸ”§
#### Makefileç›®æ ‡
```bash
make test           # è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test-coverage  # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-unit      # åªè¿è¡Œå•å…ƒæµ‹è¯•
make test-integration # åªè¿è¡Œé›†æˆæµ‹è¯•
make bench          # è¿è¡ŒåŸºå‡†æµ‹è¯•
make perf           # è¿è¡Œæ€§èƒ½æµ‹è¯•
make bench-profile  # å¸¦CPUåˆ†æçš„åŸºå‡†æµ‹è¯•
```

#### æµ‹è¯•ä¾èµ–
- `github.com/stretchr/testify` - æ–­è¨€å’Œæµ‹è¯•å¥—ä»¶
- `k8s.io/client-go/kubernetes/fake` - Kuberneteså®¢æˆ·ç«¯æ¨¡æ‹Ÿ
- `k8s.io/client-go/dynamic/fake` - åŠ¨æ€å®¢æˆ·ç«¯æ¨¡æ‹Ÿ

## æµ‹è¯•ç»Ÿè®¡

### æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡
- **æµ‹è¯•æ–‡ä»¶æ•°é‡**: 5ä¸ª
- **æµ‹è¯•å‡½æ•°æ•°é‡**: 25+
- **åŸºå‡†æµ‹è¯•**: 6ä¸ª
- **é›†æˆæµ‹è¯•**: 1ä¸ªå®Œæ•´å¥—ä»¶

### æµ‹è¯•ç±»å‹åˆ†å¸ƒ
- **å•å…ƒæµ‹è¯•**: 70%
- **é›†æˆæµ‹è¯•**: 20%
- **æ€§èƒ½æµ‹è¯•**: 10%

## ä»£ç è´¨é‡æ”¹è¿›

### 1. ç±»å‹å®‰å…¨
- ä½¿ç”¨æ¥å£ç±»å‹ `kubernetes.Interface` è€Œä¸æ˜¯å…·ä½“ç±»å‹
- æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œæ¨¡æ‹Ÿæ”¯æŒ

### 2. é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- é€‚å½“çš„HTTPçŠ¶æ€ç 
- é”™è¯¯æ—¥å¿—è®°å½•

### 3. æ€§èƒ½ç›‘æ§
- è¯·æ±‚å¤„ç†æ—¶é—´è®°å½•
- èµ„æºæ•°é‡ç»Ÿè®¡
- è¯¦ç»†çš„æ“ä½œæ—¥å¿—

## ä½¿ç”¨è¯´æ˜

### è¿è¡Œæµ‹è¯•
```bash
# è¿›å…¥backendç›®å½•
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-coverage

# è¿è¡Œæ€§èƒ½æµ‹è¯•
make perf

# è¿è¡ŒåŸºå‡†æµ‹è¯•
make bench
```

### æŸ¥çœ‹æ—¥å¿—
å¯åŠ¨åº”ç”¨åï¼Œæ—¥å¿—ä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ“ä½œä¿¡æ¯ï¼š
```
Starting K8s Resource Visualizer backend...
Initializing Kubernetes client...
âœ“ Kubernetes client initialized successfully
Setting up HTTP router and middleware...
âœ“ CORS middleware configured
Registering API routes...
âœ“ API routes registered:
  - GET /api/health
  - GET /api/resources/:type
  - GET /api/resources/:type/:name/children
  - GET /api/namespaces
ğŸš€ Server starting on :8080
Ready to accept requests...
```

## åç»­å»ºè®®

1. **ç›‘æ§é›†æˆ**: è€ƒè™‘æ·»åŠ PrometheusæŒ‡æ ‡
2. **ç¼“å­˜æœºåˆ¶**: å¯¹é¢‘ç¹æŸ¥è¯¢çš„èµ„æºæ·»åŠ ç¼“å­˜
3. **é™æµä¿æŠ¤**: æ·»åŠ APIé™æµæœºåˆ¶
4. **æ›´å¤šèµ„æºç±»å‹**: æ ¹æ®éœ€è¦æ‰©å±•æ”¯æŒçš„èµ„æºç±»å‹
5. **é…ç½®åŒ–**: å°†å¸¸è§èµ„æºç±»å‹åˆ—è¡¨é…ç½®åŒ–

## æ€»ç»“
é€šè¿‡æ·»åŠ å®Œæ•´çš„æµ‹è¯•å¥—ä»¶å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œåº”ç”¨ç°åœ¨å…·æœ‰ï¼š
- ğŸ§ª **å…¨é¢çš„æµ‹è¯•è¦†ç›–**
- ğŸš€ **ä¼˜åŒ–çš„æ€§èƒ½**
- ğŸ“ **è¯¦ç»†çš„æ—¥å¿—è®°å½•**
- ğŸ”§ **æ˜“äºç»´æŠ¤çš„ä»£ç ç»“æ„**
- ğŸ“Š **æ€§èƒ½ç›‘æ§èƒ½åŠ›**

è¿™äº›æ”¹è¿›å¤§å¤§æé«˜äº†ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œç”Ÿäº§ç¯å¢ƒçš„å¯é æ€§ã€‚
